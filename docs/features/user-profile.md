# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ©Ÿèƒ½ä»•æ§˜æ›¸

## æ¦‚è¦
Slackãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å€‹äººæƒ…å ±ã€å‹¤å‹™è¨­å®šã€å‹¤å‹™å±¥æ­´ã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½

## æ©Ÿèƒ½ä¸€è¦§

### 1. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤ºæ©Ÿèƒ½
- **ã‚³ãƒãƒ³ãƒ‰**: `ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±`, `ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«`, `user`
- **å ´æ‰€**: DMï¼ˆãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
- **æ©Ÿèƒ½**: ç¾åœ¨ã®å€‹äººè¨­å®šã¨åŸºæœ¬æƒ…å ±ã‚’è¡¨ç¤º

#### è¡¨ç¤ºå†…å®¹
- **åŸºæœ¬æƒ…å ±**: åå‰ã€Slackè¡¨ç¤ºåã€ç™»éŒ²æ—¥
- **é€£çµ¡å…ˆ**: é›»è©±ç•ªå·ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰
- **å‹¤å‹™æƒ…å ±**: å‹¤å‹™å½¢æ…‹ã€æ™‚çµ¦ã€äº¤é€šè²»
- **çµ±è¨ˆæƒ…å ±**: ç·å‹¤å‹™æ™‚é–“ã€ä»Šæœˆã®å‹¤å‹™æ™‚é–“

#### è¡¨ç¤ºå½¢å¼
```
ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«
â”£ ğŸ“ åå‰: å±±ç”°å¤ªéƒ
â”£ ğŸ’¬ Slackè¡¨ç¤ºå: @yamada
â”£ ğŸ“ é€£çµ¡å…ˆ: 090-1234-5678
â”£ ğŸ’¼ å‹¤å‹™å½¢æ…‹: ã‚¢ãƒ«ãƒã‚¤ãƒˆ
â”£ ğŸ’° æ™‚çµ¦: 1,500å††
â”£ ğŸšƒ äº¤é€šè²»: 500å††
â”— ğŸ“Š ä»Šæœˆå‹¤å‹™: 12æ™‚é–“
```

### 2. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†æ©Ÿèƒ½
- **ã‚¢ã‚¯ã‚»ã‚¹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ å„ç¨®ç·¨é›†ãƒœã‚¿ãƒ³
- **å ´æ‰€**: DM
- **æ©Ÿèƒ½**: å€‹äººæƒ…å ±ã®ç·¨é›†ãƒ»æ›´æ–°

#### ç·¨é›†å¯èƒ½é …ç›®
- **åå‰**: ãƒ•ãƒ«ãƒãƒ¼ãƒ ï¼ˆå¿…é ˆï¼‰
- **é€£çµ¡å…ˆ**: é›»è©±ç•ªå·ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- **å‹¤å‹™å½¢æ…‹**: æ­£ç¤¾å“¡ã€å¥‘ç´„ç¤¾å“¡ã€ã‚¢ãƒ«ãƒã‚¤ãƒˆã€æ´¾é£
- **æ™‚çµ¦**: æ™‚é–“ã‚ãŸã‚Šã®å ±é…¬é¡
- **äº¤é€šè²»**: æ—¥é¡ã®äº¤é€šè²»

#### ç·¨é›†ãƒ•ãƒ­ãƒ¼
1. ç·¨é›†å¯¾è±¡é …ç›®ã®ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
2. å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
3. æ–°ã—ã„å€¤ã‚’å…¥åŠ›
4. ä¿å­˜å®Ÿè¡Œ
5. æ›´æ–°å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º

### 3. å‹¤å‹™æ™‚é–“ç¢ºèªæ©Ÿèƒ½
- **ã‚¢ã‚¯ã‚»ã‚¹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ å‹¤å‹™æ™‚é–“ç¢ºèª
- **å ´æ‰€**: DM
- **æ©Ÿèƒ½**: æŒ‡å®šæœˆã®å‹¤å‹™æ™‚é–“ã¨çµ¦ä¸è¨ˆç®—

#### ç¢ºèªãƒ•ãƒ­ãƒ¼
1. å‹¤å‹™æ™‚é–“ç¢ºèªãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
2. å¹´æœˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤ºï¼ˆYYYYMMå½¢å¼ï¼‰
3. å¯¾è±¡æœˆã®å‹¤å‹™ãƒ‡ãƒ¼ã‚¿é›†è¨ˆ
4. çµæœè¡¨ç¤ºï¼ˆå‹¤å‹™æ™‚é–“ãƒ»çµ¦ä¸ãƒ»è©³ç´°ï¼‰

#### è¡¨ç¤ºå†…å®¹
- **å‹¤å‹™æ—¥æ•°**: å®Ÿéš›ã«åƒã„ãŸæ—¥æ•°
- **ç·å‹¤å‹™æ™‚é–“**: æ™‚é–“ãƒ»åˆ†ã§ã®è¡¨ç¤º

#### è¨ˆç®—å¼
```python
# å‹¤å‹™æ™‚é–“è¨ˆç®—
work_hours = (end_time - start_time - break_time_minutes) / 60
```

### 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªå‹•ç™»éŒ²æ©Ÿèƒ½
- **ãƒˆãƒªã‚¬ãƒ¼**: åˆå›Slackæ“ä½œæ™‚
- **å ´æ‰€**: ã‚·ã‚¹ãƒ†ãƒ å†…éƒ¨å‡¦ç†
- **æ©Ÿèƒ½**: Slackãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è‡ªå‹•å–å¾—ãƒ»ç™»éŒ²

#### è‡ªå‹•å–å¾—æƒ…å ±
- **Slackãƒ¦ãƒ¼ã‚¶ãƒ¼ID**: ä¸€æ„è­˜åˆ¥å­
- **è¡¨ç¤ºå**: Slackãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®åå‰
- **ãƒªã‚¢ãƒ«ãƒãƒ¼ãƒ **: Slackãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®æœ¬å
- **ç™»éŒ²æ—¥æ™‚**: ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæ™‚åˆ»

#### åˆæœŸå€¤è¨­å®š
- **åå‰**: Slackè¡¨ç¤ºåã¾ãŸã¯ãƒªã‚¢ãƒ«ãƒãƒ¼ãƒ 
- **å‹¤å‹™å½¢æ…‹**: nullï¼ˆæœªè¨­å®šï¼‰
- **æ™‚çµ¦**: nullï¼ˆæœªè¨­å®šï¼‰
- **äº¤é€šè²»**: nullï¼ˆæœªè¨­å®šï¼‰

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### usersãƒ†ãƒ¼ãƒ–ãƒ«è©³ç´°
```sql
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL,                    -- ãƒ¦ãƒ¼ã‚¶ãƒ¼å
  slack_user_id TEXT UNIQUE,             -- Slackãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  slack_display_name TEXT,               -- Slackè¡¨ç¤ºå
  contact TEXT,                          -- é€£çµ¡å…ˆ
  work_type TEXT,                        -- å‹¤å‹™å½¢æ…‹
  transportation_cost NUMERIC,           -- äº¤é€šè²»ï¼ˆæ—¥é¡ï¼‰
  hourly_wage NUMERIC,                   -- æ™‚çµ¦
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- **name**: å¿…é ˆã€100æ–‡å­—ä»¥å†…
- **contact**: ä»»æ„ã€200æ–‡å­—ä»¥å†…
- **work_type**: ä»»æ„ã€50æ–‡å­—ä»¥å†…
- **transportation_cost**: ä»»æ„ã€0ä»¥ä¸Šã®æ•°å€¤
- **hourly_wage**: ä»»æ„ã€0ä»¥ä¸Šã®æ•°å€¤

## ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

### ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—ãƒ»ä½œæˆ
```python
def get_or_create_user(slack_user_id: str, display_name: str) -> User:
    """
    Slackãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å–å¾—ã¾ãŸã¯æ–°è¦ä½œæˆ
    1. slack_user_idã§æ¤œç´¢
    2. å­˜åœ¨ã—ãªã„å ´åˆã¯æ–°è¦ä½œæˆ
    3. Slackè¡¨ç¤ºåã‚’è‡ªå‹•è¨­å®š
    """
    user = find_user_by_slack_id(slack_user_id)
    if not user:
        user = create_user({
            'name': display_name or slack_user_id,
            'slack_user_id': slack_user_id,
            'slack_display_name': display_name
        })
    return user
```

### å‹¤å‹™æ™‚é–“é›†è¨ˆ
```python
def calculate_monthly_work_summary(user_id: str, year: int, month: int):
    """
    æŒ‡å®šæœˆã®å‹¤å‹™ã‚µãƒãƒªãƒ¼è¨ˆç®—
    1. è©²å½“æœˆã®worksãƒ¬ã‚³ãƒ¼ãƒ‰å–å¾—
    2. å‹¤å‹™æ™‚é–“ã®è¨ˆç®—ï¼ˆä¼‘æ†©æ™‚é–“ã‚’é™¤ãï¼‰
    """
    works = get_works_by_month(user_id, year, month)

    total_hours = 0
    work_days = 0

    for work in works:
        if work.end_time:
            hours = calculate_work_hours(work)
            total_hours += hours
            work_days += 1

    return {
        'total_hours': total_hours,
        'work_days': work_days
    }
```

### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
```python
def update_user_profile(user_id: str, field: str, value: any) -> bool:
    """
    ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®éƒ¨åˆ†æ›´æ–°
    1. å…¥åŠ›å€¤ã®æ¤œè¨¼
    2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ›´æ–°
    3. updated_atè‡ªå‹•æ›´æ–°
    """
    if not validate_profile_field(field, value):
        return False

    return update_user_field(user_id, field, value)
```

## UIè¨­è¨ˆä»•æ§˜

### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤º
```json
{
  "type": "section",
  "fields": [
    {"type": "mrkdwn", "text": "*åå‰:* å±±ç”°å¤ªéƒ"},
    {"type": "mrkdwn", "text": "*Slackå:* @yamada"},
    {"type": "mrkdwn", "text": "*é€£çµ¡å…ˆ:* 090-1234-5678"},
    {"type": "mrkdwn", "text": "*å‹¤å‹™å½¢æ…‹:* ã‚¢ãƒ«ãƒã‚¤ãƒˆ"}
  ]
}
```

### ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ 
```json
{
  "type": "modal",
  "title": "ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†",
  "blocks": [
    {
      "type": "input",
      "label": "åå‰",
      "element": {
        "type": "plain_text_input",
        "action_id": "edit_name",
        "initial_value": "ç¾åœ¨ã®åå‰",
        "max_length": 100
      }
    }
  ]
}
```

### å‹¤å‹™æ™‚é–“è¡¨ç¤º
```json
{
  "type": "section",
  "text": {
    "type": "mrkdwn",
    "text": "*2024å¹´12æœˆã®å‹¤å‹™å®Ÿç¸¾*\nâ€¢ å‹¤å‹™æ—¥æ•°: 20æ—¥\nâ€¢ ç·å‹¤å‹™æ™‚é–“: 160æ™‚é–“\n"
  }
}
```

## APIä»•æ§˜

### ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
```python
def get_user_by_slack_id(slack_user_id: str) -> Optional[User]:
    """Slack IDã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å–å¾—"""

def get_user_profile(user_id: str) -> dict:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è©³ç´°å–å¾—"""
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°
```python
def update_user_name(user_id: str, name: str) -> bool:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼åæ›´æ–°"""

def update_user_contact(user_id: str, contact: str) -> bool:
    """é€£çµ¡å…ˆæ›´æ–°"""

def update_user_work_info(user_id: str, work_type: str,
                         hourly_wage: float, transportation_cost: float) -> bool:
    """å‹¤å‹™æƒ…å ±æ›´æ–°"""
```

### å‹¤å‹™çµ±è¨ˆå–å¾—
```python
def get_monthly_work_stats(user_id: str, year: int, month: int) -> dict:
    """æœˆæ¬¡å‹¤å‹™çµ±è¨ˆå–å¾—"""

def get_user_work_summary(user_id: str) -> dict:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼å‹¤å‹™ã‚µãƒãƒªãƒ¼å–å¾—"""
```

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### å…¥åŠ›å€¤æ¤œè¨¼
```python
def validate_user_input(field: str, value: str) -> tuple[bool, str]:
    """
    ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®æ¤œè¨¼
    Returns: (is_valid, error_message)
    """
    if field == 'name':
        if not value.strip():
            return False, "åå‰ã¯å¿…é ˆã§ã™"
        if len(value) > 100:
            return False, "åå‰ã¯100æ–‡å­—ä»¥å†…ã§å…¥åŠ›ã—ã¦ãã ã•ã„"

    elif field == 'hourly_wage':
        try:
            wage = float(value)
            if wage < 0:
                return False, "æ™‚çµ¦ã¯0ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„"
        except ValueError:
            return False, "æ™‚çµ¦ã¯æ•°å€¤ã§å…¥åŠ›ã—ã¦ãã ã•ã„"

    return True, ""
```

### æ¥­å‹™ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
- **é‡è¤‡ãƒ¦ãƒ¼ã‚¶ãƒ¼**: åŒä¸€Slack IDã®é‡è¤‡ç™»éŒ²é˜²æ­¢
- **å¿…é ˆé …ç›®**: åå‰ã®ç©ºæ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯
- **æ•°å€¤ç¯„å›²**: æ™‚çµ¦ãƒ»äº¤é€šè²»ã®è² æ•°ãƒã‚§ãƒƒã‚¯

### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
```python
ERROR_MESSAGES = {
    'user_not_found': 'ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
    'invalid_month': 'æ­£ã—ã„å¹´æœˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆYYYYMMå½¢å¼ï¼‰',
    'update_failed': 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ',
    'no_work_data': 'æŒ‡å®šã•ã‚ŒãŸæœˆã®å‹¤å‹™ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“'
}
```

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜

### ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **DMé™å®š**: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã¯DMã§ã®ã¿è¡¨ç¤ºãƒ»ç·¨é›†
- **æœ¬äººé™å®š**: è‡ªåˆ†ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ã¿æ“ä½œå¯èƒ½
- **Slackèªè¨¼**: Slack IDã«ã‚ˆã‚‹æœ¬äººç¢ºèª

### ãƒ‡ãƒ¼ã‚¿ä¿è­·
- **å€‹äººæƒ…å ±ä¿è­·**: ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
- **æš—å·åŒ–**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é€šä¿¡ãƒ»ä¿å­˜ã®æš—å·åŒ–
- **ç›£æŸ»ãƒ­ã‚°**: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å¤‰æ›´ã®è¨˜éŒ²ä¿æŒ

### ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼
- **æƒ…å ±é–‹ç¤ºåˆ¶é™**: å¿…è¦æœ€å°é™ã®æƒ…å ±ã®ã¿è¡¨ç¤º
- **ãƒ‡ãƒ¼ã‚¿ä¿æŒæœŸé–“**: é€€è·å¾Œã®ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ãƒãƒªã‚·ãƒ¼
- **åŒæ„ç®¡ç†**: ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨ã«é–¢ã™ã‚‹åŒæ„ç¢ºèª

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä»•æ§˜

### å¿œç­”æ™‚é–“ç›®æ¨™
- **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¡¨ç¤º**: 1ç§’ä»¥å†…
- **æƒ…å ±æ›´æ–°**: 2ç§’ä»¥å†…
- **å‹¤å‹™çµ±è¨ˆ**: 3ç§’ä»¥å†…

### ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°**: 1,000ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¾ã§
- **å‹¤å‹™ãƒ‡ãƒ¼ã‚¿**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ãŸã‚Šå¹´é–“3,000ãƒ¬ã‚³ãƒ¼ãƒ‰
- **åŒæ™‚ã‚¢ã‚¯ã‚»ã‚¹**: 50ä¸¦è¡Œå‡¦ç†ã¾ã§

### æœ€é©åŒ–æ–½ç­–
- **ã‚¯ã‚¨ãƒªæœ€é©åŒ–**: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æ´»ç”¨
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹æœ€é©åŒ–**: ä¸è¦ãƒ‡ãƒ¼ã‚¿ã®é™¤å¤–
